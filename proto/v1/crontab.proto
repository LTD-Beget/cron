syntax = 'proto3';

package beget.crontab.v1.crontab;

import "crontab/proto/v1/structures.proto";
import "google/api/annotations.proto";

service CrontabService {
    //Выводит полный список заданий пользователя
    rpc findAll (FindAllRequest) returns (FindAllResponse) {
        option (google.api.http) = {
            get: "/v1/crontab/list/all"
        };
    }

    //Поиск конкретной задачи
    rpc findOne (FindOneRequest) returns (FindOneResponse) {
        option (google.api.http) = {
            get: "/v1/crontab/list/{id}"
        };
    }

    //Возвращает email, на который отправляется вывод Cron-задач
    rpc getNotificationEmail (GetNotificationEmailRequest) returns (GetNotificationEmailResponse) {
        option (google.api.http) = {
            get: "/v1/crontab/email"
        };
    }

    //Устанавливает email, на который отправляется вывод Cron-задач
    rpc setNotificationEmail (SetNotificationEmailRequest) returns (SetNotificationEmailResponse) {
        option (google.api.http) = {
            post: "/v1/crontab/email"
            body: "*"
        };
    }

    //Создание новой задачи
    rpc createJob (CreateJobRequest) returns (CreateJobResponse) {
        option (google.api.http) = {
            post: "/v1/crontab/add"
            body: "*"
        };
    }

    //Удаление задачи
    rpc deleteJob (DeleteJobRequest) returns (DeleteJobResponse) {
        option (google.api.http) = {
            delete: "/v1/crontab/delete/{id}"
            body: "*"
        };
    }

    //Правка существующей задачи
    rpc editJob (EditJobRequest) returns (EditJobResponse) {
        option (google.api.http) = {
            patch: "/v1/crontab/edit/{id}"
            body: "*"
        };
    }

    //Включение задания
    rpc enableJob (EnableJobRequest) returns (EnableJobResponse) {
        option (google.api.http) = {
            post: "/v1/crontab/enable/{id}"
        };
    }

    //Отключение задания
    rpc disableJob (DisableJobRequest) returns (DisableJobResponse) {
        option (google.api.http) = {
            post: "/v1/crontab/disable/{id}"
        };
    }

    //Запускает произвольную команду
    rpc executeCommand (ExecuteCommandRequest) returns (ExecuteCommandResponse) {
        option (google.api.http) = {
            post: "/v1/crontab/command"
            body: "*"
        };
    }

    //Список запущенных вручную задач
    rpc getExecutedCommandList (GetExecutedCommandListResponse) returns (GetExecutedCommandListRequest) {
        option (google.api.http) = {
            get: "/v1/crontab/command/all"
        };
    }

    //Возвращает определённую команду
    rpc getExecutedCommand (GetExecutedCommandRequest) returns (GetExecutedCommandResponse) {
        option (google.api.http) = {
            get: "/v1/crontab/command/{manual_job_id}"
        };
    }

    //Возвращает вывод задачи, которая была запущена через API/CP вручную
    rpc getCommandOutput (GetCommandOutputRequest) returns (GetCommandOutputResponse) {
        option (google.api.http) = {
            post: "/v1/crontab/command/{manual_job_id}"
        };
    }
}

message FindAllRequest {
}

message FindAllResponse {
    oneof result {
        Success success = 1;
        Error error = 2;
    }

    message Success {
        repeated structures.CrontabJob crontab_job = 1;
    }

    message Error {
        Code code = 1;
        string message = 2;

        enum Code {
            INTERNAL_ERROR = 0;
        }
    }
};

message FindOneRequest {
    uint32 id = 1;
}

message FindOneResponse {
    oneof result {
        structures.CrontabJob crontab_job = 1;
        Error error = 2;
    }

    message Error {
        Code code = 1;
        string message = 2;

        enum Code {
            INTERNAL_ERROR = 0;
        }
    }
}

message GetNotificationEmailRequest {
}

message GetNotificationEmailResponse {
    oneof result {
        string email = 1;
        Error error = 2;
    }

    message Error {
        Code code = 1;
        string message = 2;

        enum Code {
            INTERNAL_ERROR = 0;
            NOT_AVAILABLE = 1;
        }
    }
}

message SetNotificationEmailRequest {
    string email = 1;
}

message SetNotificationEmailResponse {
    oneof result {
        Success success = 1;
        Error error = 2;
    }

    message Success {
    }

    message Error {
        Code code = 1;
        string message = 2;

        enum Code {
            INTERNAL_ERROR = 0;
            EMAIL_VALIDATION_FAILED = 1;
            NOT_AVAILABLE = 2;
        }
    }
}

message CreateJobRequest {
    //Минуты, в которые выполняется задание. Могут быть от 0 до 59
    string minutes = 1;
    //Часы выполнения, от 0 до 23
    string hours = 2;
    //День месяца, от 1 до 31
    string days = 3;
    //Месяц, от 1 до 12
    string months = 4;
    //День недели, от 0 до 7, где 0 и 7 - воскресенье
    string weekdays = 5;
    //Выполняемая команда
    string command = 6;
    //Комментарий к задаче
    string comment = 7;
}

message CreateJobResponse {
    oneof result {
        structures.CrontabJob crontab_job = 1;
        Error error = 2;
    }

    message Error {
        Code code = 1;
        string message = 2;

        enum Code {
            INTERNAL_ERROR = 0;
            NOT_AVAILABLE = 1;
            VALIDATION_ERROR = 2;
        }
    }
}

message DeleteJobRequest {
    uint32 id = 1;
}

message DeleteJobResponse {
    oneof result {
        Success success = 1;
        Error error = 2;
    }

    message Success {
    };

    message Error {
        Code code = 1;
        string message = 2;

        enum Code {
            INTERNAL_ERROR = 0;
        }
    }
}

message EditJobRequest {
    uint32 id = 1;
    //Минуты, в которые выполняется задание. Могут быть от 0 до 59
    string minutes = 3;
    //Часы выполнения, от 0 до 23
    string hours = 4;
    //День месяца, от 1 до 31
    string days = 5;
    //Месяц, от 1 до 12
    string months = 6;
    //День недели, от 0 до 7, где 0 и 7 - воскресенье
    string weekdays = 7;
    //Выполняемая команда
    string command = 8;
    //Комментарий к задаче
    string comment = 9;
}

message EditJobResponse {
    oneof result {
        structures.CrontabJob crontab_job = 1;
        Error error = 2;
    }

    message Error {
        Code code = 1;
        string message = 2;

        enum Code {
            INTERNAL_ERROR = 0;
            VALIDATION_ERROR = 1;
        }
    }
}

message EnableJobRequest {
    uint32 id = 1;
}

message EnableJobResponse {
    oneof result {
        structures.CrontabJob crontab_job = 1;
    }

    message Error {
        Code code = 1;
        string message = 2;

        enum Code {
            INTERNAL_ERROR = 0;
        }
    }
}

message DisableJobRequest {
    uint32 id = 1;
}

message DisableJobResponse {
    oneof result {
        structures.CrontabJob crontab_job = 1;
    }

    message Error {
        Code code = 1;
        string message = 2;

        enum Code {
            INTERNAL_ERROR = 0;
        }
    }
}

message ExecuteCommandRequest {
    string command = 1;
}

message ExecuteCommandResponse {
    oneof result {
        uint32 id = 1;
        Error error = 2;
    }

    message Error {
        Code code = 1;
        string message = 2;

        enum Code {
            INTERNAL_ERROR = 0;
        }
    }
}

message GetCommandOutputRequest {
    uint32 manual_job_id = 1;
}

message GetCommandOutputResponse {
    oneof result {
        string result = 1;
        Error error = 2;
    }

    message Error {
        Code code = 1;
        string message = 2;

        enum Code {
            INTERNAL_ERROR = 0;
        }
    }
}

message GetExecutedCommandListRequest {
}

message GetExecutedCommandListResponse {
    oneof result {
        Success success = 1;
        Error error = 2;
    }

    message Success {
        repeated structures.ExecutedCommand command = 1;
    }

    message Error {
        Code code = 1;
        string message = 2;

        enum Code {
            INTERNAL_ERROR = 0;
        }
    }
}

message GetExecutedCommandRequest {
    uint32 manual_job_id = 1;
}

message GetExecutedCommandResponse {
    oneof result {
        structures.ExecutedCommand command = 1;
        Error error = 2;
    }

    message Error {
        Code code = 1;
        string message = 2;

        enum Code {
            INTERNAL_ERROR = 0;
        }
    }
}
